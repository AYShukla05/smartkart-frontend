<div class="p-6">
  <div class="max-w-4xl mx-auto">
    <!-- Header -->
    <div class="mb-6">
      <h1 class="text-2xl font-bold" style="color: var(--color-text)">
        Category Management
      </h1>
      <p style="color: var(--color-text-secondary)">
        Add, edit, and manage product categories
      </p>
    </div>

    <!-- Add/Edit Form -->
    <div
      class="mb-6 p-6"
      style="
        background: var(--color-bg);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-md);
      "
    >
      <h2 class="text-lg font-medium mb-4" style="color: var(--color-text)">
        {{ editingId() ? "Edit Category" : "Add New Category" }}
      </h2>

      <form [formGroup]="categoryForm" (ngSubmit)="onSubmit()" class="space-y-4">
        <div>
          <label
            for="name"
            class="block text-sm font-medium mb-2"
            style="color: var(--color-text)"
          >
            Name
          </label>
          <input
            #nameInput
            type="text"
            id="name"
            formControlName="name"
            class="w-full px-4 py-2 transition-all focus:ring-2 focus:ring-offset-1"
            style="
              border: 1px solid var(--color-border);
              border-radius: var(--radius-md);
              font-size: var(--text-base);
              outline: none;
              --tw-ring-color: var(--color-primary);
            "
            [style.border-color]="
              name?.invalid && name?.touched
                ? 'var(--color-danger)'
                : 'var(--color-border)'
            "
            placeholder="Category name"
          />
          @if (name?.invalid && name?.touched) {
          <p class="mt-1 text-sm" style="color: var(--color-danger)">
            @if (name?.errors?.['required']) { Name is required } @else if
            (name?.errors?.['minlength']) { Name must be at least 2 characters }
          </p>
          }
        </div>

        <div class="flex gap-3">
          <button
            type="submit"
            [disabled]="isSubmitting()"
            class="px-4 py-2 font-medium transition-all cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed"
            style="
              background: var(--color-primary);
              color: var(--color-text-inverse);
              border-radius: var(--radius-md);
            "
          >
            @if (isSubmitting()) {
            <span class="flex items-center gap-2">
              <svg class="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              Saving...
            </span>
            } @else { {{ editingId() ? "Update" : "Add" }} Category }
          </button>

          @if (editingId()) {
          <button
            type="button"
            (click)="cancelEdit()"
            class="px-4 py-2 font-medium transition-all cursor-pointer hover:opacity-80"
            style="
              background: var(--color-bg-secondary);
              color: var(--color-text);
              border-radius: var(--radius-md);
            "
          >
            Cancel
          </button>
          }
        </div>
      </form>
    </div>

    <!-- Category List -->
    <div
      style="
        background: var(--color-bg);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-md);
        overflow: hidden;
      "
    >
      <div
        class="px-6 py-4 border-b flex items-center justify-between"
        style="border-color: var(--color-border)"
      >
        <h2 class="text-lg font-medium" style="color: var(--color-text)">
          Categories
        </h2>
        @if (!isLoading() && categories().length > 0) {
        <span class="text-sm" style="color: var(--color-text-muted)">
          {{ categories().length }} {{ categories().length === 1 ? 'category' : 'categories' }}
        </span>
        }
      </div>

      @if (isLoading()) {
      <div class="p-6 text-center" style="color: var(--color-text-secondary)">
        <svg class="w-6 h-6 animate-spin mx-auto mb-2" fill="none" viewBox="0 0 24 24" style="color: var(--color-primary)">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        Loading categories...
      </div>
      } @else if (categories().length === 0) {
      <div class="p-8 text-center">
        <svg class="w-12 h-12 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color: var(--color-text-muted)">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
        </svg>
        <p class="font-medium mb-1" style="color: var(--color-text)">No categories yet</p>
        <p class="text-sm" style="color: var(--color-text-secondary)">Add your first category above to get started.</p>
      </div>
      } @else {
      <div class="divide-y" style="border-color: var(--color-border)">
        @for (category of categories(); track category.id) {
        <div
          class="px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors"
          style="border-color: var(--color-border)"
        >
          <div class="flex-1 min-w-0 mr-4">
            <h3 class="font-medium" style="color: var(--color-text)">
              {{ category.name }}
            </h3>
          </div>
          <div class="flex gap-2 flex-shrink-0">
            <button
              (click)="startEdit(category)"
              class="px-3 py-1.5 text-sm font-medium transition-all cursor-pointer hover:opacity-80"
              style="
                background: var(--color-primary-light);
                color: var(--color-primary);
                border-radius: var(--radius-md);
              "
            >
              Edit
            </button>
            <button
              (click)="confirmDelete(category.id)"
              class="px-3 py-1.5 text-sm font-medium transition-all cursor-pointer hover:opacity-80"
              style="
                background: var(--color-danger-light);
                color: var(--color-danger);
                border-radius: var(--radius-md);
              "
            >
              Delete
            </button>
          </div>
        </div>
        }
      </div>
      }
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<app-confirm-modal
  [isOpen]="deleteModalOpen()"
  title="Delete Category"
  message="Are you sure you want to delete this category? This action cannot be undone."
  confirmText="Delete"
  cancelText="Cancel"
  variant="danger"
  [isLoading]="isDeleting()"
  (confirmed)="executeDelete()"
  (cancelled)="cancelDelete()"
/>
