<div class="p-6">
  <div class="max-w-7xl mx-auto">
    <!-- Header -->
    <div class="mb-6">
      <h1 class="text-2xl font-bold" style="color: var(--color-text)">
        Browse Products
      </h1>
      <p class="text-sm mt-1" style="color: var(--color-text-secondary)">
        Discover products from our sellers
      </p>
    </div>

    <!-- Filter Bar -->
    <div
      class="flex flex-wrap items-center gap-3 mb-6 p-4"
      style="
        background: var(--color-bg);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-sm);
      "
    >
      <!-- Search -->
      <input
        type="text"
        placeholder="Search products..."
        class="filter-input flex-1 min-w-[200px] px-4 py-2"
        [value]="searchQuery()"
        (input)="onSearchInput($event)"
      />

      <!-- Category Filter -->
      <select
        class="filter-input px-4 py-2"
        [value]="selectedCategoryId() ?? ''"
        (change)="onCategoryChange($event)"
        style="background: var(--color-bg)"
      >
        <option value="">All Categories</option>
        @for (cat of categories(); track cat.id) {
        <option [value]="cat.id">{{ cat.name }}</option>
        }
      </select>

      <!-- Ordering -->
      <select
        class="filter-input px-4 py-2"
        [value]="selectedOrdering()"
        (change)="onOrderingChange($event)"
        style="background: var(--color-bg)"
      >
        @for (opt of orderingOptions; track opt.value) {
        <option [value]="opt.value">{{ opt.label }}</option>
        }
      </select>

      <!-- Clear Filters -->
      @if (hasActiveFilters()) {
      <button
        (click)="clearFilters()"
        class="px-4 py-2 text-sm font-medium transition-all hover:opacity-80 cursor-pointer"
        style="
          background: var(--color-bg-secondary);
          color: var(--color-text);
          border-radius: var(--radius-md);
        "
      >
        Clear
      </button>
      }
    </div>

    <!-- Loading -->
    @if (isLoading()) {
    <div class="p-12 text-center" style="color: var(--color-text-secondary)">
      <svg
        class="w-6 h-6 animate-spin mx-auto mb-2"
        fill="none"
        viewBox="0 0 24 24"
        style="color: var(--color-primary)"
      >
        <circle
          class="opacity-25"
          cx="12"
          cy="12"
          r="10"
          stroke="currentColor"
          stroke-width="4"
        ></circle>
        <path
          class="opacity-75"
          fill="currentColor"
          d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
        ></path>
      </svg>
      Loading products...
    </div>
    } @else if (products().length === 0) {
    <!-- Empty State -->
    <div
      class="p-12 text-center"
      style="
        background: var(--color-bg);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-sm);
      "
    >
      <svg
        class="w-12 h-12 mx-auto mb-3"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        style="color: var(--color-text-muted)"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="1.5"
          d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"
        />
      </svg>
      @if (hasActiveFilters()) {
      <p class="font-medium" style="color: var(--color-text)">
        No products match your filters
      </p>
      <p class="text-sm mt-1" style="color: var(--color-text-secondary)">
        Try adjusting your search or category filter
      </p>
      <button
        (click)="clearFilters()"
        class="mt-4 px-4 py-2 text-sm font-medium transition-all hover:opacity-80 cursor-pointer"
        style="
          background: var(--color-primary);
          color: var(--color-text-inverse);
          border-radius: var(--radius-md);
        "
      >
        Clear Filters
      </button>
      } @else {
      <p class="font-medium" style="color: var(--color-text)">
        No products available yet
      </p>
      <p class="text-sm mt-1" style="color: var(--color-text-secondary)">
        Check back later for new arrivals
      </p>
      }
    </div>
    } @else {
    <!-- Product Grid -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
      @for (product of products(); track product.id) {
      <a
        [routerLink]="['/products', product.id]"
        class="product-card block overflow-hidden"
      >
        <!-- Image -->
        <div
          class="flex items-center justify-center"
          style="
            aspect-ratio: 4/3;
            background: var(--color-bg-secondary);
          "
        >
          @if (product.thumbnail) {
          <img
            [src]="product.thumbnail"
            [alt]="product.name"
            loading="lazy"
            class="w-full h-full object-cover"
          />
          } @else {
          <svg
            class="w-12 h-12"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            style="color: var(--color-text-muted)"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="1.5"
              d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"
            />
          </svg>
          }
        </div>

        <!-- Card Body -->
        <div class="p-4">
          <span
            class="inline-block px-2 py-0.5 text-xs font-medium rounded-full mb-2"
            style="
              background: var(--color-primary-light);
              color: var(--color-primary);
            "
          >
            {{ product.category_name }}
          </span>
          <h3
            class="font-medium truncate"
            style="color: var(--color-text)"
          >
            {{ product.name }}
          </h3>
          <p
            class="text-lg font-bold mt-1"
            style="color: var(--color-primary)"
          >
            {{ product.price | currency }}
          </p>
          <p
            class="text-xs mt-1 font-medium"
            [style.color]="
              product.stock > 0
                ? 'var(--color-success)'
                : 'var(--color-danger)'
            "
          >
            {{ product.stock > 0 ? "In Stock" : "Out of Stock" }}
          </p>
        </div>
      </a>
      }
    </div>

    <!-- Pagination -->
    @if (totalCount() > pageSize) {
    <app-pagination
      [currentPage]="currentPage()"
      [totalItems]="totalCount()"
      [pageSize]="pageSize"
      (pageChange)="onPageChange($event)"
    />
    }
    }
  </div>
</div>
